---
layout: default
---

<div class="home-container">
    <div class="blog-feed">
        <!-- Loop through ALL posts for client-side filtering/pagination -->
        {% for post in site.posts %}
        {% capture cats_slugs %}{% for cat in post.categories %}{{ cat | slugify }} {% endfor %}{% endcapture %}

        <article class="blog-card" data-categories="{{ cats_slugs | strip }}" style="display: none;">
            <!-- 1. Metadata Column (Left) -->
            <div class="card-meta-col">
                <time class="card-date">{{ post.date | date: "%b %d, %Y" }}</time>
                {% if post.read_time != false %}
                <span class="card-read-time">{{ post.content | number_of_words | divided_by: 180 | plus: 1 }} min</span>
                {% endif %}
            </div>

            <!-- 2. Content Column (Middle) -->
            <div class="card-content-col">
                <h2 class="card-title">
                    <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
                </h2>

                {% if post.categories.size > 0 %}
                <div class="card-tags">
                    {% for category in post.categories %}
                    <span class="tag">{{ category }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if post.excerpt %}
                <p class="card-excerpt">{{ post.excerpt | strip_html | truncate: 160 }}</p>
                {% endif %}
            </div>

            <!-- 3. Thumbnail Column (Right) -->
            <div class="card-thumbnail-col">
                {% assign post_image = post.header.teaser | default: post.header.image | default:
                post.header.overlay_image %}
                {% if post_image %}
                <a href="{{ post.url | relative_url }}" class="card-image-link">
                    <img src="{{ post_image | relative_url }}" alt="{{ post.title }}" class="card-image" loading="lazy">
                </a>
                {% else %}
                <a href="{{ post.url | relative_url }}" class="card-image-link card-image-placeholder">
                    <div class="placeholder-icon">
                        <i class="fas fa-image"></i>
                    </div>
                </a>
                {% endif %}
            </div>
        </article>
        {% endfor %}

        <!-- Client-Side Pagination Controls -->
        <nav class="pagination" id="js-pagination" style="display: none;">
            <a href="#" class="pagination__prev" id="btn-prev" style="display: none;">← Newer</a>
            <span class="pagination__page" id="page-info"></span>
            <a href="#" class="pagination__next" id="btn-next" style="display: none;">Older →</a>
        </nav>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <h3 class="sidebar-title">Categories</h3>
        <ul class="sidebar-list">
            <li class="sidebar-item">
                <a href="/" class="cat-name">All</a>
                <span class="cat-count">({{ site.posts.size }})</span>
            </li>
            {% for category in site.categories %}
            <li class="sidebar-item">
                <a href="?category={{ category[0] | slugify }}" class="cat-name">{{ category[0] }}</a>
                <span class="cat-count">({{ category[1].size }})</span>
            </li>
            {% endfor %}
        </ul>
    </aside>
</div>

<!-- Category Filtering & Pagination JavaScript -->
<script>
    (function () {
        const POSTS_PER_PAGE = 5;
        let currentPage = 1;
        let filteredCards = []; // Array of visible DOM elements

        function initApp() {
            const urlParams = new URLSearchParams(window.location.search);
            const activeCategory = urlParams.get('category');

            // 1. Highlight Sidebar
            updateSidebar(activeCategory);

            // 2. Filter Posts
            filteredCards = getFilteredCards(activeCategory);

            // 3. Initial Render
            renderPage(1);

            // 4. Setup Event Listeners
            document.getElementById('btn-prev').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentPage > 1) renderPage(currentPage - 1);
            });

            document.getElementById('btn-next').addEventListener('click', (e) => {
                e.preventDefault();
                const totalPages = Math.ceil(filteredCards.length / POSTS_PER_PAGE);
                if (currentPage < totalPages) renderPage(currentPage + 1);
            });
        }

        function updateSidebar(activeCategory) {
            const sidebarLinks = document.querySelectorAll('.sidebar-item a');
            sidebarLinks.forEach(link => {
                const href = link.getAttribute('href');
                const isAll = !activeCategory && (href === '/' || href === '/?category=all');
                const isMatch = activeCategory && href.includes(`category=${activeCategory}`);

                if (isAll || isMatch) {
                    link.style.fontWeight = 'bold';
                    link.style.color = '#000';
                } else {
                    link.style.fontWeight = 'normal';
                    link.style.color = '#333';
                }
            });
        }

        function getFilteredCards(category) {
            const allCards = Array.from(document.querySelectorAll('.blog-card'));
            const target = category ? category.toLowerCase().trim() : 'all';

            // First, hide EVERYTHING
            allCards.forEach(card => card.style.display = 'none');

            if (!category || category === 'all') {
                return allCards;
            }

            return allCards.filter(card => {
                const rawCats = card.getAttribute('data-categories') || '';
                const cats = rawCats.trim().split(/\s+/);
                return cats.includes(target);
            });
        }

        function renderPage(page) {
            currentPage = page;
            const totalPages = Math.ceil(filteredCards.length / POSTS_PER_PAGE);

            // Hide all first (safety)
            document.querySelectorAll('.blog-card').forEach(c => c.style.display = 'none');

            // Calculate slice
            const start = (page - 1) * POSTS_PER_PAGE;
            const end = start + POSTS_PER_PAGE;
            const pageCards = filteredCards.slice(start, end);

            // Show current page cards
            pageCards.forEach(card => card.style.display = 'flex');

            // Update Controls
            const nav = document.getElementById('js-pagination');
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            const info = document.getElementById('page-info');

            if (filteredCards.length === 0) {
                nav.style.display = 'none';
                // Optional: Show "No posts found" message
            } else {
                nav.style.display = 'flex';
                info.textContent = `Page ${currentPage} of ${totalPages}`;

                btnPrev.style.display = currentPage > 1 ? 'block' : 'none';
                btnNext.style.display = currentPage < totalPages ? 'block' : 'none';
            }

            // Scroll to top of feed on change
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    })();
</script>